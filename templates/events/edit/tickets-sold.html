{% extends "events/edit/layout.html" %}

{% block edit_content %}
    <div class="event-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏</div>

    {% if ticket_stats %}
        <div class="block">
            <div class="block-header">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="list">
                {% for stat in ticket_stats %}
                    <div class="list-row list-row-hover">
                        <div class="list-cell">
                            <span>{{ stat.ticket_type__name|default:"–ë–µ–∑ —Ç–∏–ø–∞" }}</span>
                        </div>
                        <div class="list-cell" style="text-align: right;">
                            <span>{{ stat.count }} —à—Ç.</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    {% if tickets %}
        <div class="block">
            <div class="block-header block-header-with-button">
                <span>üíé –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                <div>
                    <a href="{% url "export_tickets_csv" event.id %}" class="button button-blue button-small">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</a>
                </div>
            </div>
            <div class="list">
                {% for ticket in tickets %}
                    <div class="list-row list-row-hover">
                        <div class="list-cell">
                            {% if ticket.user %}
                                <a href="{{ ticket.user.profile_url }}" target="_blank" style="text-decoration: none; color: inherit;">
                                    <div class="list-user">
                                        <span class="avatar" style="background-image: url('{{ ticket.user.avatar }}');"></span>
                                        <span>{{ ticket.user.full_name }}</span>
                                    </div>
                                </a>
                            {% endif %}
                            {% if ticket.customer_email %}
                                <div style="opacity: 0.5;">{{ ticket.customer_email }}</div>
                            {% elif not ticket.user %}
                                <div style="opacity: 0.5;">‚Äî</div>
                            {% endif %}
                        </div>
                        <div class="list-cell">
                            {{ ticket.ticket_type.name }}: ‚Ññ{{ ticket.code }}
                        </div>
                        <div class="list-cell list-cell-date">
                            {{ ticket.created_at|date:"d.m.Y H:i" }}
                        </div>
                        <div class="list-cell-actions">
                            <form method="POST" action="{% url "generate_transfer_code" ticket.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="button button-small" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –±–∏–ª–µ—Ç–∞ ‚Ññ{{ ticket.code }}?')">üîÑ Transfer</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="block">
            <div class="block-description">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤.</div>
        </div>
    {% endif %}
{% endblock %}
