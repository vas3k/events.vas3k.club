{% extends "layout.html" %}
{% load static %}
{% load text_filters %}
{% load events %}

{% block title %}
    {{ event.title }} ‚Äî {{ block.super }}
{% endblock %}

{% block content %}
    <div class="content event">
        <div class="event-sidebar">
            <a href="{% url "show_event" event.id %}">
                <span class="event-image" style="background-image: url('{{ event.icon|default:event.image }}');"></span>
            </a>

            {% if event.description %}
                <div class="event-description">{{ event.description }}</div>
            {% endif %}

            {% if event.manager_users %}
                <div class="event-managers">
                    <div class="event-managers-title">–û—Ä–≥–∞–Ω–∏–∑—É—é—Ç üëá</div>

                    {% for manager in event.manager_users %}
                        <a href="{{ manager.profile_url }}" target="_blank" class="event-manager">
                            <span class="avatar" style="background-image: url('{{ manager.avatar }}');"></span>
                            <span>{{ manager.full_name }}</span>
                        </a>
                    {% endfor %}
                </div>
            {% endif %}

            {% if event.contact_url %}
                <div class="event-contact">
                    üí¨ <a href="{{ event.contact_url }}">–°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ä–≥–∞–º–∏</a>
                </div>
            {% endif %}

            {% if request.user.is_admin %}
                <div class="event-edit-button">
                    <a href="{% url "edit_event" event.id %}" class="button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                </div>
            {% endif %}
        </div>

        <div class="event-main animate-on-load">
            <div class="event-title">{{ event.title }}</div>


            <div class="event-info">
                {% if event.location %}
                    <div class="event-location">
                        üìç
                        {% if event.location_url %}
                            <a href="{{ event.location_url }}">{{ event.location }}</a>
                        {% else %}
                            {{ event.location }}
                        {% endif %}
                    </div>
                {% endif %}

                {% if event.event_starts_at %}
                    <div class="event-date">üìÖ {% pretty_date_range event.event_starts_at event.event_ends_at %}</div>
                {% endif %}
            </div>

            {% if my_tickets %}
                <div class="event-my-tickets">
                    <div class="block-header">üíé –ú–æ–∏ –±–∏–ª–µ—Ç–∏–∫–∏</div>
                    {% for ticket in my_tickets %}
                        {% include "tickets/ticket-item.html" with ticket=ticket %}
                    {% endfor %}
                </div>
            {% endif %}

            {% if special_ticket_types %}
                <form method="post" action="{% url "buy_tickets" %}">
                    <div class="block ticket-types">
                        <div class="block-header">
                            üéüÔ∏è –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–ª–µ—Ç–∏–∫–∏
                        </div>

                        {% for ticket_type in special_ticket_types %}
                            {% include "events/ticket-type-item.html" %}
                        {% endfor %}

                        {% csrf_token %}

                        <div class="ticket-types-buy">
                            <button type="submit" class="button button-big">
                                {% if event.is_free_event %}–ó–∞–ø–∏—Å–∞—Ç—å—Å—è{% else %}–ö—É–ø–∏—Ç—å{% endif %}
                            </button>
                        </div>
                    </div>
                </form>
            {% endif %}

            {% if event.is_sale_active %}
                {% if not request.user.is_authenticated %}
                    <div class="block event-unauthenticated">
                        <div class="block-subheader">üéüÔ∏è –ë–∏–ª–µ—Ç—ã –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º —é–∑–µ—Ä–∞–º</div>
                        <div class="block-description block-description-center">
                            <a href="{% url "login_club" %}" class="button">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –í–∞—Å—Ç—Ä–∏–∫ ‚úñÔ∏é –ö–ª—É–±</a>
                        </div>
                    </div>
                {% elif request.user.is_banned_on_events %}
                    <div class="block event-banned">
                        <div class="block-header">üò¢</div>
                        <div class="block-description block-description-center">
                            –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –±–æ–ª—å—à–µ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –Ω–∞—à–∏—Ö –∏–≤–µ–Ω—Ç–∞—Ö –∏ –ø–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤ –≤–∞–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                        </div>
                    </div>
                {% else %}
                    <form method="post" action="{% url "buy_tickets" %}">
                        <div class="block ticket-types">
                            <div class="block-header">
                                üéüÔ∏è {% if event.is_free_event %}–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–≤–µ–Ω—Ç{% else %}–ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç{% endif %}
                            </div>

                            {% if not ticket_types %}
                                <div class="block-description">–•–º–º, –∞ –≥–¥–µ –≤—Å–µ –±–∏–ª–µ—Ç—ã-—Ç–æ?</div>
                            {% endif %}

                            {% for ticket_type in ticket_types %}
                                {% include "events/ticket-type-item.html" %}
                            {% endfor %}

                            {% csrf_token %}

                            <div class="ticket-types-buy">
                                <button type="submit" class="button button-big">
                                    {% if event.is_free_event %}–ó–∞–ø–∏—Å–∞—Ç—å—Å—è{% else %}–ö—É–ø–∏—Ç—å{% endif %}
                                </button>
                            </div>
                        </div>
                    </form>
                {% endif %}
            {% endif %}

            {% if event.is_sale_starts_soon %}
                <div class="block event-sale-countdown">
                    <div class="block-header">üïì –ù–∞—á–∞–ª–æ –ø—Ä–æ–¥–∞–∂–∏ –±–∏–ª–µ—Ç–æ–≤ —á–µ—Ä–µ–∑...</div>
                    <div class="countdown-timer" data-seconds="{{ event.seconds_until_sale_starts }}">
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="days">0</span>
                            <span class="countdown-label">–¥–Ω–µ–π</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="hours">00</span>
                            <span class="countdown-label">—á–∞—Å–æ–≤</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="minutes">00</span>
                            <span class="countdown-label">–º–∏–Ω—É—Ç</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="seconds">00</span>
                            <span class="countdown-label">—Å–µ–∫—É–Ω–¥</span>
                        </div>
                    </div>

                    {% if not request.user.is_authenticated %}
                        <div class="block-description block-description-center">
                            <a href="{% url "login_club" %}" class="button">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º</a>
                        </div>
                    {% endif %}
                </div>
            {% endif %}

            {% if event.is_sale_starts_soon %}
                {% if not my_notifications %}
                    <div class="block event-subscription">
                        <div class="block-subheader">üîî –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ —ç—Ç–æ–º—É –∏–≤–µ–Ω—Ç—É</div>

                        <div class="block-description event-subscription-form">
                            <form method="POST" action="{% url "subscribe" event.id "all" %}">
                                {% csrf_token %}
                                <input type="email" name="email" value="{{ request.user.email }}">
                                <button class="button button-blue">–£–≤–µ–¥–æ–º–∏—Ç–µ –º–µ–Ω—è!</button>
                            </form>
                        </div>
                    </div>
                {% else %}
                    <div class="block event-subscription">
                        <div class="block-subheader">‚úÖ –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ ¬´{{ my_notifications.0.email }}¬ª –∫–æ–≥–¥–∞ –Ω–∞—á–Ω—É—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∏</div>

                        <div class="block-description event-subscription-form">
                            <form method="POST" action="{% url "unsubscribe" event.id "all" %}">
                                {% csrf_token %}
                                <button class="button button-red">–ù–µ –Ω–∞–¥–æ!</button>
                            </form>
                        </div>
                    </div>
                {% endif %}
            {% endif %}

            {% if event.is_sold_out %}
                <div class="block event-waitlist">
                    <div class="block-header">–ö–∞–∂–µ—Ç—Å—è —É –Ω–∞—Å Sold Out üò±</div>

                    {% if event.waitlist_url %}
                        <div class="block-description">
                            –ö—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –∏ –Ω–µ –ø—Ä–∏–µ—Ö–∞—Ç—å, —Ç–∞–∫ —á—Ç–æ –º—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –≤–µ–π—Ç–ª–∏—Å—Ç.
                            –ú—ã –ø–∏–Ω–≥–∞–Ω—ë–º –≤–∞—Å –µ—Å–ª–∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –º–µ—Å—Ç–µ—á–∫–æ ‚Äî —Ç–∞–∫–æ–µ —Å–ª—É—á–∞–µ—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ :)
                        </div>

                        <div class="block-description">
                            <a href="{{ event.waitlist_url }}" class="button">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –≤–µ–π—Ç–ª–∏—Å—Ç</a>
                        </div>
                    {% else %}
                        <div class="block-description">
                            –í—Å–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ —ç—Ç–æ—Ç –∏–≤–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å :(
                        </div>
                    {% endif %}
                </div>
            {% endif %}

            {% if event.intro %}
                <div class="event-intro markdown-text">{{ event.intro | markdown }}</div>
            {% endif %}

            {% if participants %}
                <div class="block event-participants">
                    <div class="block-header">‚ù§Ô∏è –£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
                    <div class="event-participants-list">
                        {% for user in participants %}
                            <a href="{{ user.profile_url }}" class="event-participant">
                                <span class="avatar" style="background-image: url('{{ user.avatar }}');"></span>
                                <span>{{ user.full_name }}</span>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

